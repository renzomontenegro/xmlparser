<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procesador de Facturas XML</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="form-header">
            <div class="upload-section primary">
                <h2>Procesador de Facturas XML</h2>
                <p>Sube un archivo XML o completa el formulario manualmente</p>
                <input type="file" id="xmlFile" accept=".xml">
                <button type="button" id="clearFormBtn" style="margin: 10px 0px;">Limpiar Todo</button>
            </div>
            
            <div class="upload-section secondary">
                <h2>Sube aquí un JSON</h2>
                <p>Carga un formulario previamente hecho, en formato JSON</p>
                <input type="file" id="jsonFile" accept=".json">
            </div>
        </div>

        <form id="invoiceForm">
            <div class="form-grid">
                <!-- Sección 1: Información básica -->
                <div class="form-group">
                    <label for="ruc">RUC</label>
                    <input type="text" id="ruc" name="ruc" required>
                </div>

                <div class="form-group">
                    <label for="razonSocial">Razón Social</label>
                    <input type="text" id="razonSocial" name="razonSocial" required>
                </div>

                <div class="form-group">
                    <label for="moneda">Moneda</label>
                    <select id="moneda" name="moneda" required>
                        <option value="">Seleccione...</option>
                        <option value="USD">USD</option>
                        <option value="PEN">PEN</option>
                    </select>
                </div>

                <!-- Sección 2: Fechas y números -->
                <div class="form-group">
                    <label for="fechaEmision">Fecha Emisión</label>
                    <input type="date" id="fechaEmision" name="fechaEmision" required>
                </div>

                <div class="form-group">
                    <label for="fechaVencimiento">Fecha Vencimiento</label>
                    <input type="date" id="fechaVencimiento" name="fechaVencimiento" required>
                </div>

                <div class="form-group">
                    <label for="numeroComprobanteParte1">N° Comprobante de Pago</label>
                    <div class="comprobante-container">
                        <input type="text" id="numeroComprobanteParte1" maxlength="4" required>
                        <span class="separator">-</span>
                        <input type="text" id="numeroComprobanteParte2" maxlength="8" required>
                        <input type="hidden" id="numeroComprobante" name="numeroComprobante">
                    </div>
                    <small class="form-text text-muted">
                        Formato: XXXX-XXXXXXXX (ejemplo: F001-00000123)
                    </small>
                </div>

                <!-- Sección 3: Importes y condiciones -->
                <div class="form-group">
                    <label for="importe">Importe Total</label>
                    <input type="number" step="0.01" id="importe" name="importe" required>
                    <small class="form-text text-muted">(Importe con IGV)</small>
                </div>

                <div class="form-group">
                    <label for="condicionPago">Condición de Pago</label>
                    <select id="condicionPago" name="condicionPago" required>
                        <option value="">Seleccione...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="porcentajeDetraccion">Porcentaje detracción</label>
                    <select id="porcentajeDetraccion" name="porcentajeDetraccion">
                        <option value="">Seleccione...</option>
                    </select>
                </div>

                <!-- Sección 4: Información adicional -->
                <div class="form-group">
                    <label for="solicitante">Solicitante</label>
                    <input type="text" id="solicitante" name="solicitante" required>
                </div>

                <div class="form-group">
                    <label for="areaSolicitante">Área Solicitante</label>
                    <input type="text" id="areaSolicitante" name="areaSolicitante" required>
                </div>

                <div class="form-group">
                    <label for="codigoBien">Código de Detracción</label>
                    <select id="codigoBien" name="codigoBien">
                        <option value="">Seleccione...</option>
                    </select>
                </div>

                <!-- Sección 5: Fechas de licencia -->
                <div class="form-group">
                    <label for="fechaInicioLicencia">Fecha Inicio Licencia</label>
                    <input type="date" id="fechaInicioLicencia" name="fechaInicioLicencia">
                </div>

                <div class="form-group">
                    <label for="fechaFinLicencia">Fecha Fin Licencia</label>
                    <input type="date" id="fechaFinLicencia" name="fechaFinLicencia">
                </div>

                <div class="form-group">
                    <label for="descripcion">Descripción</label>
                    <input type="text" id="descripcion" name="descripcion" required>
                </div>
            </div>

            <!--Nuevos Campos-->
            <div class="form-group">
                <label for="cuentaContable">Cuenta Contable</label>
                <div class="custom-select-container">
                    <input type="text" id="cuentaContableSearch" placeholder="Buscar cuenta contable..." autocomplete="off">
                    <input type="hidden" id="cuentaContable" name="cuentaContable">
                    <div id="cuentaContableOptions" class="select-options"></div>
                </div>
            </div>

            <div class="form-group">
                <label for="tipoFactura">Tipo de Factura</label>
                <select id="tipoFactura" name="tipoFactura" required>
                    <option value="">Seleccione...</option>
                </select>
            </div>

            <!-- Sección de Items -->
            <div class="items-section">
                <h3>Items del Comprobante</h3>
                <table>
                    <thead>
                        <tr>
                            <th>N° Item</th>
                            <th>Base Imponible <small class="text-muted">(Importe sin IGV)</small></th>
                            <th>Porcentaje (%)</th>
                            <th>Línea de negocio</th>
                            <th>Centro de Costo</th>
                            <th>Proyecto</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="itemsTableBody">
                        <!-- Los items se agregarán dinámicamente -->
                    </tbody>
                </table>
                <button type="button" id="addItemBtn" style="margin-top: 10px;">Agregar Item</button>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button type="button" id="exportSolicitudBtn" style="margin: 0 10px; background-color: #005a15;">
                    Exportar Resumen para Aprobación
                </button>
                <button type="button" id="exportERPBtn" style="margin: 0 10px; background-color: #005e16;">
                    Exportar en formato ERP
                </button>
                <button type="button" id="saveFormBtn" style="margin: 0 10px; background-color: #bb6a00;">
                    Exportar en JSON
                </button>
            </div>
            <div class="centrar" style="margin-top: 20px;">
                <button type="button" id="downloadAllBtn" style="margin: 0 10px; background-color: #0105ff;">
                    Descargar Todo
                </button>
            </div>
        </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-populate/browser/xlsx-populate.min.js"></script>
    <script src="xml_parser.js"></script>
    <script src="exportacion.js"></script>
    <script src="excel_db.js"></script>
    <script src="export_all.js"></script>  
</body>
</html>